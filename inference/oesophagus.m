function oesophagus

% control
ts3(1) = 22/7;
data3{1} = sparse([
	 0  0 39 14  7  4  1  0;
	 0 59 24  6  3  0  0  0;
	32 33 17 15  1  1  0  0;
	 5 11 10  2  3  1  0  0;
	 4  6  3  1  1  0  1  0;
	 5  1  1  2  1  0  1  0;
	 1  4  3  2  0  1  0  1;
	 0  1  0  0  0  0  1  0;
	 0  0  0  0  1  0  0  0;
	 0  0  1  0  1  0  0  0;
	 0  0  0  1  0  0  0  0;
	 0  0  0  0  1  0  0  0
	]);

ts3(2) = 30/7;
data3{2} = sparse([
	 0  0 26  9  3  2  1  0  0  0;
	 0 35 32  8  9  1  1  0  0  0;
	12 26 23 12  8  2  2  1  0  0;
	 3  8  6 10  7  2  0  0  1  0;
	 3  5  9  6  7  3  0  0  0  1;
	 1  0  2  9  6  2  1  0  0  0;
	 0  2  1  1  0  2  1  0  0  0;
	 0  1  0  1  1  2  1  3  1  0;
	 0  0  1  1  1  2  1  1  0  1;
	 0  0  0  0  2  1  0  1  0  0
	]);
data3{2}(16, 7) = 1;
data3{2}(17,10) = 1;

% pre-treat/atra homoestasis
ts3(3) = 3;
data3{3} = sparse([
	0	31	23	21	10	7	1	0	0	1	0	0	0;
	9	21	24	10	10	5	3	0	1	0	0	0	0;
	8	25	16	14	4	1	2	1	1	0	0	0	0;
	4	2	14	5	5	6	0	2	1	0	0	1	0;
	3	2	7	7	4	2	3	3	1	0	0	0	0;
	0	2	2	1	1	3	0	0	1	0	0	0	0;
	0	1	1	2	1	2	2	1	0	1	0	0	0;
	1	0	0	1	0	5	0	0	0	1	0	0	0;
	0	0	0	0	0	1	3	0	0	0	0	1	0;
	0	0	0	0	1	0	2	0	0	0	0	0	0;
	0	0	0	0	0	1	1	0	0	0	0	1	0;
	0	0	0	0	0	0	0	0	0	0	0	1	0;
	0	0	0	0	0	0	1	0	0	0	1	0	0]);
data3{3}(15+1,12+1) = 1;
data3{3}(17+1, 7+1) = 1;
data3{3}(19+1,10+1) = 1;
data3{3}(19+1,20+1) = 1;

ts3(4) = 6;
databs{4} = sparse([
	0	7	12	2	4	2	0	1	0	0	0	0	0	0	0	0;
	3	15	10	7	9	1	0	0	0	0	0	0	0	0	0	0;
	4	26	12	9	4	1	1	0	1	0	0	0	0	0	0	0;
	4	4	17	10	7	2	2	1	0	0	0	0	1	0	0	0;
	1	5	5	8	6	5	3	0	1	0	0	0	1	0	0	0;
	0	1	3	4	2	6	5	1	1	0	1	0	0	0	0	0;
	0	0	2	1	2	3	2	3	0	1	0	1	0	0	0	0;
	0	0	1	3	3	1	0	0	2	0	1	0	0	0	0	0;
	0	0	0	1	0	0	2	0	1	0	0	1	0	0	0	0;
	0	0	0	0	0	0	5	1	0	1	0	0	1	0	0	0;
	0	0	0	0	2	0	0	1	0	3	0	0	1	1	0	0;
	0	0	0	0	0	0	3	1	1	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	1	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	1	0	1	0;
	0	0	0	0	0	0	1	0	1	0	0	0	0	0	0	0]);
data3{4}(20+1,20+1) = 1;
data3{4}(21+1,13+1) = 1;
data3{4}(25+1,21+1) = 1;
data3{4}(46+1,40+1) = 1;
data3{4}(51+1,26+1) = 1;

% atra treatement, 3 weeks after induction
ts3(5) = 22/7;
data3{5} = sparse([
	0	23	29	17	8	2	2	0	0	0	0;
	14	48	23	7	2	2	0	2	0	0	0;
	15	32	23	15	6	3	0	0	0	0	0;
	8	11	22	15	3	1	1	0	0	0	0;
	0	6	15	10	5	5	0	0	0	0	0;
	1	4	5	3	1	1	0	0	0	0	0;
	0	1	1	3	7	1	0	0	0	0	0;
	0	0	0	0	3	3	0	0	0	0	0;
	0	0	0	4	1	1	0	0	0	0	0;
	0	0	0	0	1	0	0	0	0	0	0;
	0	0	0	0	2	2	0	0	0	1	0;
	0	0	0	1	0	0	0	0	0	0	0;
	0	0	0	0	2	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	1	0	0	0	1;
	0	0	0	0	0	0	1	0	2	0	0;
	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	1	0	0	0	0	0]);

ts3(6) = 30/7;
data3{6} = sparse([
	0	22	29	21	11	11	6	1	0	0	0	0	1	0	0	0	0	0	0	0;
	5	24	14	19	11	3	5	1	0	1	0	0	0	0	0	0	0	0	0	0;
	2	19	19	18	10	4	3	1	0	0	0	0	0	0	0	0	0	0	0	0;
	2	3	6	9	8	5	3	0	1	0	0	0	0	0	0	0	0	0	0	0;
	0	1	9	8	4	6	4	2	1	2	0	0	0	0	0	0	0	0	0	1;
	0	0	2	7	2	4	1	2	2	1	0	0	0	0	0	0	0	0	0	0;
	0	0	0	2	3	2	1	0	1	1	0	1	0	0	0	0	0	0	0	0;
	0	0	2	3	1	1	0	1	0	0	1	0	0	0	0	0	0	0	0	0;
	0	0	1	2	2	0	0	2	1	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	1	0	1	0	0	1	1	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1;
	0	0	0	0	0	1	0	1	0	0	0	1	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	1	0	0	1	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	1	0	0	0	0	0	0	0	1	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	1	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	0]);

% optimal estimates
% rho:	0.49465 +- 0.0298334
% r:	0.220243 +- 0.0239353
% lambda:	0.797034 +- 0.0328321 (control)
%           1.4 (ATRA homoeostasis)
rho = 0.49465;
r = 0.220243;
lambda1 = 0.797034;
lambda2 = 1.4;

bubble_compare(lambda1*ts3(1), data3{1}, r, rho/(1-rho), ...
    'oes-comparison-control-22-days');
bubble_compare(lambda1*ts3(2), data3{2}, r, rho/(1-rho), ...
    'oes-comparison-control-30-days');

bubble_compare(lambda1*3 + lambda2*(ts3(5)-3), ...
    data3{5}, r, rho/(1-rho), ...
    'oes-comparison-atra-post-treat-22-days');
bubble_compare(lambda1*3 + lambda2*(ts3(6)-3), ...
    data3{6}, r, rho/(1-rho), ...    
    'oes-comparison-atra-post-treat-30-days');

!rubber --pdf oesophagus-fit.tex

end
